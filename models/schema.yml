# Schema.yml

version: 2

sources:
  - name: raw
    schema: gz_raw_data
    description: dataset bigquery
    loader: BigQuery 
    tables:
    - name: sales
      identifier: raw_gz_sales
      description: sales of Greenweez / we have one row per product_id found in each orders_id
      tests:
        - unique: 
            column_name: "(orders_id || '-' || pdt_id)"
        - freshness:
            loaded_at_field: "CAST(date_date AS TIMESTAMP)"
            warn_after: {count: 90, period: day}
      columns:
        - name: date_date
          description: date of order
        - name: orders_id
          description: identifier of the order
        - name: pdt_id
          description: identifier of the product
        - name: revenue
          description: revenue generated by selling the products
        - name: quantity
          description: quantity of products ordered
    - name: product
      identifier: raw_gz_product
      description: list of products offered by Greenweez / we have one row per products_id with its purchase price
      columns:
        - name: products_id
          description: identifier of the product
          tests:
            - unique
            - not_null
        - name: purchase_price
          description: price at which the product is offered for sale
    - name: ship
      identifier: raw_gz_ship
      description: shipping fee and costs related to orders / we have one row per orders_id
      columns:
        - name: orders_id
          description: identifier of orders
          tests:
            - unique
            - not_null
        - name: shipping_fee
          description: fee paid by customers for the transportation (frais de livraison)
        - name: logcost
          description: transportation costs
        - name: ship_cost
          description: costs of shipping

models:
- name: int_orders_margin
  description: sum of margin, revenue, purchase_cost by orders_id (date_date level remains available)
  columns:
    - name: orders_id
      description: identifier of orders
      tests:
        - unique
        - not_null
    - name: margin
      description: revenue - purchase_cost (purchase_cost = purchase_price * quantity)
- name: int_orders_operational
  description: provides the operational margin, which corresponds to: margin + shipping_fee (paid by customer) - shipping and logistic costs
  columns:
    - name: orders_id
      description: identifier of orders
      tests:
        - unique
        - not_null
- name: int_sales_margin
  description: gives the margin by products_id for each order_id (with date_date)
  columns:
    - name: "(products_id || '-' || orders_id)"
      tests:
        - unique
        - not_null       

      